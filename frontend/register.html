<!doctype html>
<html lang="en">

<head>
    <link rel="icon" type="image/png" href="img/coupon.png">
    <title>
        COUPONS APP
    </title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="css/fonts-google-roboto.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- Material Kit CSS -->
    <link href="css/templatemo-style.css" rel="stylesheet">
    <link href="css/material-dashboard.css?v=2.1.1" rel="stylesheet" />
</head>

<body>
    <div class="modal fade" id="register_success_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>User created successfully!</b></h4>
            </div>
            <div class="modal-footer">
              <button type="button" class='templatemo-blue-button width-100' id='ok_registered_success' data-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="register_fail_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Could not create user! Please try again and provide username and password.</b></h4>
            </div>
            <div class="modal-footer">
              <button type="button" class='templatemo-blue-button width-100' data-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="no_username_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Please insert a email!</b></h4>
            </div>
            <div class="modal-footer">
              <button type="button" class='templatemo-blue-button width-100' data-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="no_pass_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Please insert a password and confirmation!</b></h4>
            </div>
            <div class="modal-footer">
              <button type="button" class='templatemo-blue-button width-100' data-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="no_conf_pass_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Please confirm password!</b></h4>
            </div>
            <div class="modal-footer">
              <button type="button" class='templatemo-blue-button width-100' data-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="pass_mismatch_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Passwords do not match! Please try again!</b></h4>
            </div>
            <div class="modal-footer">
              <button type="button" class='templatemo-blue-button width-100' data-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="short_pass_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Password should be at least 6 characters long!</b></h4>
            </div>
            <div class="modal-footer">
              <button type="button" class='templatemo-blue-button width-100' data-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="alert_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Incorrect password!</b></h4>
            </div>
            <div class="modal-body">
              <p>Please insert password again to clear event.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal" id="close_modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="clear_alert_modal" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><b>Enter password to clear event</b></h4>
            </div>
            <div class="modal-body">
              <center>
                <form> 
                    <input type = 'password' id='login_modal_password' placeholder = '********'> 
                </form> 
              </center>
            </div>
            <div class="modal-footer" id="clear_alert_modal_confirm_btn_div">
              <!--button type="button" class='templatemo-blue-button width-100' id='confirm_clear_alert' data-dismiss="modal">Confirm</button-->
            </div>
          </div>
        </div>
      </div>

    <div class="wrapper">
        <div class="main-panel-register">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="navbar-toggler-icon icon-bar"></span>
                        <span class="navbar-toggler-icon icon-bar"></span>
                        <span class="navbar-toggler-icon icon-bar"></span>
                    </button>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="content" style="display: block; margin-left: auto; margin-right: auto;">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header card-header-info">
                                    <h4 class="card-title">Register</h4>
                                    <p class="card-category">Enter your information</p>
                                </div>
                                <div class="card-body">
                                    <form>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="bmd-label-floating">Email Address</label>
                                                    <input type="email" class="form-control" id="email">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="bmd-label-floating">Password</label>
                                                    <input type="password" class="form-control" id="pass" autocomplete="new-password">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="bmd-label-floating">Confirm Password</label>
                                                    <input type="password" class="form-control" id="confirm_pass">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="bmd-label-floating">Last Name</label>
                                                    <input type="text" class="form-control" id="lname">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="bmd-label-floating">First Name</label>
                                                    <input type="text" class="form-control" id="fname">
                                                </div>
                                            </div>
                                        </div>
                                        <button class="btn btn-info pull-right" id="create_new_user">Register</button>
                                        <div class="clearfix"></div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <div class="copyright float-right">
                        &copy;
                        <script>
                            document.write(new Date().getFullYear())
                        </script>
                    </div>
                    <!-- your footer here -->
                </div>
            </footer>
        </div>
    </div>
    <script src="js/core/jquery.min.js"></script>
    <script src="js/core/popper.min.js"></script>
    <script src="js/core/bootstrap-material-design.min.js"></script>
    <script src="js/plugins/perfect-scrollbar.jquery.min.js"></script>
    <script src="js/material-dashboard.js?v=2.1.1" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>

    <script src='js/graph_interface.js'></script>
    <script src='js/nfc_interface.js'></script>

    <script>
        //TODO: Call  backend

    function createAccount( firstName, email, pass, lastName )
    {
        $.LoadingOverlay("show");
        // initiate post to beckend to create new account
        $.ajax({
            url: "http://localhost:8123/api/v1/customer-controller/create-customer",
            type: "POST",
			contentType: "application/json;",
			dataType: "json",
			beforeSend: function (xhr) {
				xhr.setRequestHeader ("Authorization", "Basic " + btoa( "api-user:admin" ));
				},
            data:JSON.stringify({'firstName':firstName,'password':pass,'email':email,'lastName':lastName}),
            success: function(result) {
                 $.LoadingOverlay("hide");	
            }
         })
         window.location = "login.html";
    }
    $(document).ready(function() {
     // window.BMSGraphClient = BMSGraph.use( 'http://localhost/graphql' );

      md.checkSidebarImage();


      $().ready(function() {
        $sidebar = $('.sidebar');
        $sidebar_img_container = $sidebar.find('.sidebar-background');
        $full_page = $('.full-page');
        $sidebar_responsive = $('body > .navbar-collapse');

        window_width = $(window).width();

        fixed_plugin_open = $('.sidebar .sidebar-wrapper .nav li.active a p').html();

        if (window_width > 767 && fixed_plugin_open == 'Dashboard') {
          if ($('.fixed-plugin .dropdown').hasClass('show-dropdown')) {
            $('.fixed-plugin .dropdown').addClass('open');
          }

          }
      });
      $("#create_new_user").click(function(){
            var firstName = $("#fname").val();
            var email = $("#email").val();
            var pass = $("#pass").val();
            var confPass = $("#confirm_pass").val();
            var lastName = $("#lname").val();
			
			if(pass) {
				if(confPass) {
					if(pass == confPass) {
						if(validateEmail(email)) {
							createAccount(firstName, email, pass, lastName);
						}else{
						 $('#no_username_modal').modal();
						}
					}else{
						 $('#pass_mismatch_modal').modal();
					}
				}else{
					$('#no_conf_pass_modal').modal();
				}
			}else{
				$('#no_pass_modal').modal();
			}
            return event.preventDefault();  
        });
    });
		function validateEmail(email) {     
		 var re = /\S+@\S+.\S+/;     
		 return re.test(email);  
	}

    </script>
</body>

</html>
